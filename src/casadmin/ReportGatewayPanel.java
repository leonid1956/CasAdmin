package casadmin;

import java.awt.Dimension;
import java.util.*;

public class ReportGatewayPanel extends javax.swing.JPanel {

    public ReportGatewayPanel() {
        initComponents();
        Date d = new Date();
        dcOdDatyNadania.setDate(d);
        dcDoDatyNadania.setDate(d);
        String query = "select distinct gs.id_cust, c.skrotnaz from gate_stat gs, v_customers c where gs.id_cust=c.id_cust(+) order by gs.id_cust";
        comboIdCust.removeAllItems();
        comboIdCust.addItem("*.* - Wszystkie");
        Vector<Vector<String> > v = GlobalData.oraSession.selectAllRecordsToVector(query, null);
        Iterator it = v.iterator();
        while (it.hasNext())
        {
            Vector<String> line = (Vector<String>)it.next();
            comboIdCust.addItem((String)line.elementAt(0) + " - " + (String)line.elementAt(1));
        }
        comboIdCust.setSelectedIndex(0);

    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jSplitPane1 = new javax.swing.JSplitPane();
        upPanel = new javax.swing.JPanel();
        panelQuery = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        dcOdDatyNadania = new com.toedter.calendar.JDateChooser();
        jLabel73 = new javax.swing.JLabel();
        dcDoDatyNadania = new com.toedter.calendar.JDateChooser();
        jbShow = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        comboIdCust = new javax.swing.JComboBox();
        downPanel = new javax.swing.JPanel();
        panelResult = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tableResult = new javax.swing.JTable();

        setName("Form"); // NOI18N
        setLayout(new java.awt.GridLayout(1, 0));

        jSplitPane1.setDividerLocation(100);
        jSplitPane1.setOrientation(javax.swing.JSplitPane.VERTICAL_SPLIT);
        jSplitPane1.setName("jSplitPane1"); // NOI18N

        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(casadmin.CasAdminApp.class).getContext().getResourceMap(ReportGatewayPanel.class);
        upPanel.setBackground(resourceMap.getColor("upPanel.background")); // NOI18N
        upPanel.setName("upPanel"); // NOI18N
        upPanel.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        panelQuery.setBackground(resourceMap.getColor("panelQuery.background")); // NOI18N
        panelQuery.setBorder(javax.swing.BorderFactory.createTitledBorder(resourceMap.getString("panelQuery.border.title"))); // NOI18N
        panelQuery.setName("panelQuery"); // NOI18N
        panelQuery.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel1.setText(resourceMap.getString("jLabel1.text")); // NOI18N
        jLabel1.setName("jLabel1"); // NOI18N
        panelQuery.add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 20, -1, 20));

        dcOdDatyNadania.setDateFormatString(resourceMap.getString("dcOdDatyNadania.dateFormatString")); // NOI18N
        dcOdDatyNadania.setName("dcOdDatyNadania"); // NOI18N
        panelQuery.add(dcOdDatyNadania, new org.netbeans.lib.awtextra.AbsoluteConstraints(100, 20, 110, 20));

        jLabel73.setText(resourceMap.getString("jLabel73.text")); // NOI18N
        jLabel73.setName("jLabel73"); // NOI18N
        panelQuery.add(jLabel73, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 40, -1, 30));

        dcDoDatyNadania.setDateFormatString(resourceMap.getString("dcDoDatyNadania.dateFormatString")); // NOI18N
        dcDoDatyNadania.setName("dcDoDatyNadania"); // NOI18N
        panelQuery.add(dcDoDatyNadania, new org.netbeans.lib.awtextra.AbsoluteConstraints(100, 50, 110, 20));

        jbShow.setText(resourceMap.getString("jbShow.text")); // NOI18N
        jbShow.setName("jbShow"); // NOI18N
        jbShow.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbShowActionPerformed(evt);
            }
        });
        panelQuery.add(jbShow, new org.netbeans.lib.awtextra.AbsoluteConstraints(540, 50, 80, -1));

        jLabel2.setText(resourceMap.getString("jLabel2.text")); // NOI18N
        jLabel2.setName("jLabel2"); // NOI18N
        panelQuery.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(240, 20, 40, 20));

        comboIdCust.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        comboIdCust.setName("comboIdCust"); // NOI18N
        panelQuery.add(comboIdCust, new org.netbeans.lib.awtextra.AbsoluteConstraints(280, 20, 340, -1));

        upPanel.add(panelQuery, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 10, 630, 80));

        jSplitPane1.setTopComponent(upPanel);

        downPanel.setBackground(resourceMap.getColor("downPanel.background")); // NOI18N
        downPanel.setName("downPanel"); // NOI18N
        downPanel.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        panelResult.setBackground(resourceMap.getColor("panelResult.background")); // NOI18N
        panelResult.setBorder(javax.swing.BorderFactory.createTitledBorder(resourceMap.getString("panelResult.border.title"))); // NOI18N
        panelResult.setName("panelResult"); // NOI18N
        panelResult.setLayout(new java.awt.GridLayout(1, 0));

        jScrollPane1.setName("jScrollPane1"); // NOI18N

        tableResult.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {},
                {},
                {},
                {}
            },
            new String [] {

            }
        ));
        tableResult.setName("tableResult"); // NOI18N
        tableResult.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tableResultMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tableResult);

        panelResult.add(jScrollPane1);

        downPanel.add(panelResult, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 10, 960, 410));

        jSplitPane1.setRightComponent(downPanel);

        add(jSplitPane1);
    }// </editor-fold>//GEN-END:initComponents


    private void jbShowActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbShowActionPerformed
        String selectedCust = (String)comboIdCust.getSelectedItem();
        int pos = selectedCust.indexOf(' ');
        selectedCust = selectedCust.substring(0, pos);
        String subQuery = selectedCust.equals("*.*") ? "" : " and id_cust = " + selectedCust;
        
        
        String query =
         "select * from gate_stat " +
         "where insertt between to_date('" + YPFunctions.DateToString(dcOdDatyNadania.getDate()) +
         " 00:00:00','yyyy/mm/dd hh24:mi:ss') and " +
         " to_date('" + YPFunctions.DateToString(dcDoDatyNadania.getDate()) +
         " 23:59:59','yyyy/mm/dd hh24:mi:ss')" + subQuery;


        YPFunctions.clearContainer(panelResult);

        this.setCursor(java.awt.Cursor.getPredefinedCursor(java.awt.Cursor.WAIT_CURSOR));
        
        YPFunctions.FillTableFromOra(query, null, 0, 99999, tableResult, null, null, false, true, null, null, Boolean.FALSE);
        this.setCursor(java.awt.Cursor.getDefaultCursor());
}//GEN-LAST:event_jbShowActionPerformed

    private Date getDateFromStr(String p_date)
    {
        int year = Integer.parseInt(p_date.substring(0, 4));
        int month = Integer.parseInt(p_date.substring(5, 7));
        int day = Integer.parseInt(p_date.substring(8, 10));
        int hours = Integer.parseInt(p_date.substring(11, 13));
        int mins = Integer.parseInt(p_date.substring(14, 16));
        int secs = Integer.parseInt(p_date.substring(17));
        return new Date(year - 1900, month - 1, day, hours, mins, secs);
    }


    private void tableResultMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tableResultMouseClicked
        if (evt.getClickCount() > 1)
        {
             int i = tableResult.getSelectedRow();

             String s = ((String)tableResult.getValueAt(i, 5)).trim();
             Date fromDate = getDateFromStr(s);
             s = ((String)tableResult.getValueAt(i, 6)).trim();
             Date toDate = getDateFromStr(s);
             Object o = tableResult.getValueAt(i, 1);
             String id_cust = o.toString().trim();

            // Podwójny click na linijce tablicy
            // Pokazujemy panel szczegółow przesyłek z wyznaczonymi kryteriami
            YPFunctions.showPanelAsModalDialog(new ShipmentsPanel(fromDate, toDate, id_cust, ""), "Przegląd informacji o przesyłkach",
                                                   new Dimension(1017,700));
        }

    }//GEN-LAST:event_tableResultMouseClicked




    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JComboBox comboIdCust;
    private com.toedter.calendar.JDateChooser dcDoDatyNadania;
    private com.toedter.calendar.JDateChooser dcOdDatyNadania;
    private javax.swing.JPanel downPanel;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel73;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JSplitPane jSplitPane1;
    private javax.swing.JButton jbShow;
    private javax.swing.JPanel panelQuery;
    private javax.swing.JPanel panelResult;
    private javax.swing.JTable tableResult;
    private javax.swing.JPanel upPanel;
    // End of variables declaration//GEN-END:variables
}

