package casadmin;

import java.util.*;

public class HistoryPanel extends javax.swing.JPanel {

    public HistoryPanel() {
        initComponents();
        showHistory();
    }

    private void showHistory() {
        YPFunctions.FillTableFromOra(
                "Select version as \"Wersja\", description as \"Opis\" from cas_history order by version",
                new Vector(),
                0,
                99999,
                tableHistory,
                new Vector(Arrays.asList(10,900)),
                null,
                false,
                true,
                new Vector(),
                new Vector(),
                false);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jSplitPane1 = new javax.swing.JSplitPane();
        upPanel = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        tfVersion = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        taDescription = new javax.swing.JTextArea();
        jbAdd = new javax.swing.JButton();
        jbDelete = new javax.swing.JButton();
        downPanel = new javax.swing.JPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        tableHistory = new javax.swing.JTable();

        setName("Form"); // NOI18N
        setLayout(new java.awt.GridLayout(1, 0));

        jSplitPane1.setDividerLocation(100);
        jSplitPane1.setOrientation(javax.swing.JSplitPane.VERTICAL_SPLIT);
        jSplitPane1.setName("jSplitPane1"); // NOI18N

        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(casadmin.CasAdminApp.class).getContext().getResourceMap(HistoryPanel.class);
        upPanel.setBackground(resourceMap.getColor("upPanel.background")); // NOI18N
        upPanel.setName("upPanel"); // NOI18N
        upPanel.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jPanel1.setBackground(resourceMap.getColor("jPanel1.background")); // NOI18N
        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(resourceMap.getString("jPanel1.border.title"))); // NOI18N
        jPanel1.setName("jPanel1"); // NOI18N
        jPanel1.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel1.setText(resourceMap.getString("jLabel1.text")); // NOI18N
        jLabel1.setName("jLabel1"); // NOI18N
        jPanel1.add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 20, -1, -1));

        tfVersion.setText(resourceMap.getString("tfVersion.text")); // NOI18N
        tfVersion.setName("tfVersion"); // NOI18N
        jPanel1.add(tfVersion, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 40, 130, -1));

        jLabel2.setText(resourceMap.getString("jLabel2.text")); // NOI18N
        jLabel2.setName("jLabel2"); // NOI18N
        jPanel1.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(150, 10, -1, 30));

        jScrollPane1.setName("jScrollPane1"); // NOI18N

        taDescription.setColumns(20);
        taDescription.setFont(resourceMap.getFont("taDescription.font")); // NOI18N
        taDescription.setLineWrap(true);
        taDescription.setRows(5);
        taDescription.setWrapStyleWord(true);
        taDescription.setName("taDescription"); // NOI18N
        jScrollPane1.setViewportView(taDescription);

        jPanel1.add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(180, 20, 520, 50));

        jbAdd.setText(resourceMap.getString("jbAdd.text")); // NOI18N
        jbAdd.setName("jbAdd"); // NOI18N
        jbAdd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbAddActionPerformed(evt);
            }
        });
        jPanel1.add(jbAdd, new org.netbeans.lib.awtextra.AbsoluteConstraints(710, 50, 100, -1));

        jbDelete.setText(resourceMap.getString("jbDelete.text")); // NOI18N
        jbDelete.setName("jbDelete"); // NOI18N
        jbDelete.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbDeleteActionPerformed(evt);
            }
        });
        jPanel1.add(jbDelete, new org.netbeans.lib.awtextra.AbsoluteConstraints(710, 20, 100, -1));

        upPanel.add(jPanel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 10, 820, 80));

        jSplitPane1.setTopComponent(upPanel);

        downPanel.setBackground(resourceMap.getColor("downPanel.background")); // NOI18N
        downPanel.setName("downPanel"); // NOI18N
        downPanel.setLayout(new java.awt.GridLayout());

        jScrollPane2.setName("jScrollPane2"); // NOI18N

        tableHistory.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        tableHistory.setName("tableHistory"); // NOI18N
        tableHistory.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tableHistoryMouseClicked(evt);
            }
            public void mouseReleased(java.awt.event.MouseEvent evt) {
                tableHistoryMouseReleased(evt);
            }
        });
        tableHistory.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                tableHistoryKeyReleased(evt);
            }
        });
        jScrollPane2.setViewportView(tableHistory);
        tableHistory.getColumnModel().getColumn(0).setHeaderValue(resourceMap.getString("tableHistory.columnModel.title0")); // NOI18N
        tableHistory.getColumnModel().getColumn(1).setHeaderValue(resourceMap.getString("tableHistory.columnModel.title1")); // NOI18N
        tableHistory.getColumnModel().getColumn(2).setHeaderValue(resourceMap.getString("tableHistory.columnModel.title2")); // NOI18N
        tableHistory.getColumnModel().getColumn(3).setHeaderValue(resourceMap.getString("tableHistory.columnModel.title3")); // NOI18N

        downPanel.add(jScrollPane2);

        jSplitPane1.setRightComponent(downPanel);

        add(jSplitPane1);
    }// </editor-fold>//GEN-END:initComponents

    private void tableHistoryMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tableHistoryMouseClicked
        if (evt.getClickCount() == 2) {
            String sDesc = YPFunctions.strGet(tableHistory,tableHistory.getSelectedRow(), 1);
            YPFunctions.showMessage(sDesc,"");
        }

    }//GEN-LAST:event_tableHistoryMouseClicked

    private void jbAddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbAddActionPerformed
        String Version = tfVersion.getText().trim();
        String Desc = taDescription.getText().trim();
        if (Version.equals("") || Desc.equals("")) {
            YPFunctions.showErrorMessage("Nie wypełnione wszystkie pola");
//            JOptionPane.showMessageDialog(null, "Nie wypełnione wszystkie pola","Błąd",JOptionPane.ERROR_MESSAGE);
            return;
        }
        GlobalData.oraSession.executeQuery("delete from cas_history where version=?", new Vector(Arrays.asList(tfVersion.getText().trim())));
        GlobalData.oraSession.executeQuery("Insert into cas_history(version, description, writer) values(?,?,?)",
                new Vector(Arrays.asList(tfVersion.getText().trim(),taDescription.getText().trim(),GlobalData.m_sUserLogin)));

       showHistory();
    }//GEN-LAST:event_jbAddActionPerformed

    private void tableHistoryMouseReleased(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tableHistoryMouseReleased
       showLine();
    }//GEN-LAST:event_tableHistoryMouseReleased

    private void jbDeleteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbDeleteActionPerformed
       GlobalData.oraSession.executeQuery("delete from cas_history where version=?", new Vector(Arrays.asList(tfVersion.getText().trim())));
       showHistory();
    }//GEN-LAST:event_jbDeleteActionPerformed

    private void tableHistoryKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_tableHistoryKeyReleased
       showLine();
    }//GEN-LAST:event_tableHistoryKeyReleased

    private void showLine() {
        String sVer = YPFunctions.strGet(tableHistory,tableHistory.getSelectedRow(), 0);
        tfVersion.setText(sVer);
        String sDesc = YPFunctions.strGet(tableHistory,tableHistory.getSelectedRow(), 1);
        taDescription.setText(sDesc);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel downPanel;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JSplitPane jSplitPane1;
    private javax.swing.JButton jbAdd;
    private javax.swing.JButton jbDelete;
    private javax.swing.JTextArea taDescription;
    private javax.swing.JTable tableHistory;
    private javax.swing.JTextField tfVersion;
    private javax.swing.JPanel upPanel;
    // End of variables declaration//GEN-END:variables

}
